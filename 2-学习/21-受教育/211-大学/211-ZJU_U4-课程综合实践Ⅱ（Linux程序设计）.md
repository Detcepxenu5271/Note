# 课程综合实践Ⅱ（Linux程序设计）


## 自我计划
### Linux 安装
采用虚拟机（VMWare Workstation 
16 Player）安装 Ubuntu 系统

VMWare 版本：16.2.3 build-19376536
Ubuntu 版本：Ubuntu 22.04 LTS

内存 4096 MB，硬盘 30 GB，处理器数量为 2，每个处理器内核数量为 2

## 课堂笔记
### 教学大纲
课程目的：使学生熟悉 Linux 操作系统的安装、使用和管理，Linux 的文件、进程概念，以及 I/O 重定向，Linux 下的桌面系统以及各种工具软件的使用，shell 程序设计。

课程目标：
1. 了解 Linux 操作系统，学习并领会自由软件（Free Software）的思想和文化
2. 掌握 Linux 操作系统的安装
3. 掌握 Linux 的文件、进程概念，管道及 I/O 重定向
4. 掌握 Linux 系统常用命令、实用程序的使用和管理，熟悉 Linux 下各种工具软件的使用
5. 了解 Linux 环境下开发环境和桌面系统 
6. 了解 shell 编程，掌握基本的 bash 程序设计
7. 了解 Linux 环境下的 API 编程以及 Linux 的系统调用

### ch0 课程导读
两次大作业
	实验报告整合成一个 pdf，不要打包
	代码不要图像
	实验小题要有运行结果截图
1. shell 命令 \[7.20 23:55\]
2. 程序设计 \[8.15 23:55\]
	- 代码上传 PTA（查重用）
	- 注释要用中文，多写，五行一写
	- 5、6、7 三题需要设计文档（重要）

### ch1 Linux 概述
Linux：Linux 内核（Kernel）
Linux 操作系统：GNU/Linux 系统（基于 Linux 的 GNU 系统）

GNU 是一个项目，基于自由软件（free software）思想，意在开发一个完整的类 Unix 系统，可以被不受限制地修改和传播。
* GNU 目前没有完成内核的开发，实际在操作系统中使用的内核是由 Linux 项目独立发展出来的
* GNU 环境包含了其他主要部件，比如编辑器、编译器、调试器等等

自由软件的四项基本自由
	“要说一个软件是‘自由’的，这意味着它尊重用户的基本自由：自由地运行这个软件，学习和修改它，以及重新发布它的原版或修改版。”
1. 运行
2. 研究如何运行和改写（需要源代码）
3. 重新发布拷贝
4. 改进并向公众发布改进（需要源代码）

自由软件精神的四个方面
1. 自由使用软件
2. 自由传播软件
3. 自由修改软件
4. 自由再传播自己修改好的软件

Copyleft，Copyright

开放源代码 = 代码 + 许可证 + 管理机制

自由 != 开源
* 自由在意的是自由权利本身
* 开源在意的是这种开发方式的**实用**性，便于让软件强大可靠

Linux 发展的五个支柱
1. UNIX 操作系统
2. MINIX 操作系统
3. GNU
4. POSIX 标准
5. INTERNET（互联网）

超级计算机参数
* PFlops/s：每秒浮点运算次数，P 代表 PB（一千万亿，KB -> MB -> GB -> TB -> PB）
* Rpeak 是理论最大值，Rmax 是实际测试最大值

Linux 内核版本：前两个数字表示版本号，第三个数字表示修订（如 4.13.3），测试版用 rc（Release Candidate）表示（如 4.14-rc5）

### ch2 Linux 基础
图形桌面
* **GNOME** 桌面（目前主要用这个）
* KDE 桌面
* Unity 桌面

Linux 启动
* 有 0-6 七个启动级别
* `$runlevel`命令显示系统运行级
* root 身份执行`$init n`，进入运行级 n

Linux 退出
* 用户退出系统：`Ctrl+D`结束当前进程，或`$logout`命令
* 关机命令：`$shutdown`、`$halt`、`$init 0`、`$poweroff`，需要 root 权限
	- 指定关机时间
		+ `$shutdown -h 8:00`早上八点关机
		+ `$shutdown -h +3`三分钟后关机

shell
* 是 Linux 系统的用户界面，被称为 Linux 的命令解释器
* 默认 shell：bash shell

shell 命令
* 两种命令
	- 内部命令：shell 自带
	- 外部命令：存放在其他地方的**可执行文件**或 **shell 脚本**
* 查看命令是哪种命令：`type 命令`

shell 命令搜索路径
* 搜索目录名保存在 shell 变量`PATH`下
	- shell 变量的表示要在前面加`$`，形如`$PATH`
* PATH 中的目录名用冒号`:`隔开
* PATH 保存在

元字符
* 通配符
	- `{}`：通配符扩展，扩展方式类似分配律
		+ `prefix{0,1,2}`会被扩展为`prefix0 prefix1 prefix2`

常用命令
1. `passwd`：修改密码
	- Ubuntu 设置 root 密码：`sudo passwd root`
2. `su`：改变用户身份
3. `sudo`：以 root 用户权限运行命令
4. `sudo`：以 root 用户权限运行命令
	- `useradd` / `adduser`：添加用户
	- `userdel` / `deluser`：删除用户
5. `man`、`info`：获取帮助命令
6. `whatis`：命令的更短描述名
7. `whoami`：显示用户名
8. `hostname`：显示登陆
9. `uname`：显示关于运行
10. `id`：
11. `isb_release`：
12. `neofetch`：

### ch3 Linux 文件管理操作
#### 3.1 Linux的文件概念、文件类型、文件系统
Linux 文件概念
* 文件是一个**字节序列**
* 所有东西都被看作文件处理

文件类型
* 普通文件
	- 文件名最长 255 字符
* 目录文件
	- 文件系统中一个目录所包含的目录项组成的文件
	- 只允许系统修改
* 设备文件
	- 分为两种
		+ 字符设备文件
		+ 块设备文件
	- 用于将对设备的 I/O 当作对文件的读取 / 写入
	- 没有文件长度，有两个值：主设备号和从设备号，共同形成的唯一码可供内核查找对应的设备驱动程序
* 链接文件
* 管道（FIFO）文件
* Socket（套接字）文件

文件系统概念
* FAT（MS-DOS）
* FAT32（VFAT），exFAT（64位）
* NTFS（NT 文件系统）
* ext4（Linux）

#### 3.2 文件系统命令
#### 3.3 文件系统操作
* `ls`命令中`-l`选项各字段的含义
	1. 访问权限
	2. 链接数
	3. 所有者的登录名
	4. 所有者的组名
	5. 文件大小（单位：字节）
	6. 最近修改的月份
	7. 最近修改的日期
	8. 最近修改的时间
	9. 文件名

#### 3.6 文件的压缩、排序、查找
正则表达式

文件压缩
* **gzip**：压缩单个文件（不能打包）；将原始文件删除，只留下压缩文件
	- 配套 gunzip，解压缩
* **bzip2**
* **gzexe**：压缩可执行文件
* **zcat**、**zmore**：显示用 gzip 或 compress 压缩的文件内容
* **tar**：可以打包，可以调用其他压缩程序
	- `-c`：压缩；`-x`：解压
	- `-z`：使用 gzip；`-j`：使用 bzip2
	- `-f`：
	- `-v`：详细显示文件处理过程

文件排序（排序文件内容）

### ch4 文件安全与信息共享
三层次文件保护机制
1. 登录名和密码
2. 文件加密
3. 文件访问特权

用户分类
	注：有一个 root 特殊用户，称超级用户或根用户，可以访问所有文件。用户名为 root，用户 ID 为 0
1. 所有者（owner users）
2. 组（group users）
3. 其他人（other users）

文件访问权限
* 读 read（r）
* 写 write（w）
* 执行 execute（x）

u、g、o 各有三种访问权限，各 3 bit，总共 9 bit

### ch5 进程、重定向和管道
#### 5.1 进程
查看进程：`ps`
* 三种风格的参数
	- Unix：单破折线
	- BSD：不加破折线
	- GNU：双破折线

前台和后台
* 前台：当前命令执行结束前，不能执行任何命令
* 后台：执行命令的同时，可以看到 shell 提示符，且可以做其他工作
	- 后台执行的方式：命令后加`&`，形如`命令&`
		+ 返回值为`[作业号] 进程PID`
	- `fg [%jobid]`：使作业号为 jobid 的后台进程转为前台（前台继续执行）
	- `Ctrl+Z`：挂起前台进程
	- `bg`：把被挂起的进程转到后台

#### 5.2 重定向
文件描述符
* 类似 Windows 下的句柄

### ch7 Linux 软件开发工具
运行效率分析：`time [用户命令]`

### ch8 Bash 编程
#### shell 变量
#### 给 shell 脚本传递参数
`$0`是脚本文件名称（命令名称），参数依次存储在`$1, $2, ..., $9, ${10}, ${11}, ...`中

`$#`是参数个数，`$*`和`$@`是所有参数的值，前者在被双引号包括的时候仍为一个整体，而后者把每个参数的值作为字符串

`shift [N]`：把命令行参数向左移动 N 个（挤掉前 N 个，不影响`$0`）

`eval [参数]`：将参数解释一遍再执行（例如，假设命令行参数有 5 个，`echo \$$#`就会先被解释成`echo $5`，再执行）

#### source、点（.）和 null 命令
`source filename`或`. filename`：使用当前 shell 程序执行 fileName 中的命令

`:`：null 命令，什么也不做，返回值总是 0（正确退出）

#### 程序控制流程语句
##### 一、If 语句
```bash
if expression then
	#statements
elif expression then
	#statements
elif expression then
	#statements
else
	#statements
fi
```

test 命令：`test expression`或`[ expression ]`
* 返回 true 或 false
* 注意方括号里的空格

#### 数值数据处理
所有值以**字符串**方式存储，只支持**整数**运算

### ch9 系统程序设计
#### Linux 环境下函数的使用
#### 文件和目录操作
#### 进程控制
#### 进程通信
#### 线程

## 实验
### 实验一
40 个小题，工作量不一

### 实验二
## shell 命令笔记
1. Makefile
2. 多文件编译，Makefile
3. shell 脚本统计目录文件数目、字节总和
4. shell 脚本判断回文
5. shell 脚本，备份程序
6. bash 程序，类 vi/vim 文本编辑器
7. （二选一）
	1. myshell（20分）
	2. myls（10分）

### 〇、未归类
* `pwd`：print working dirctory
* `alias`：设置别名
	- `alias name=value`：设置别名（value 是字符串，需要的话可以用引号括起来）
	- `alias name`：显示 name 是什么别名（value 是什么）
	- 不加参数：显示别名列表
	- `unalias name`：取消别名
		+ `-a`：删除所有
	- 注：别名只在当前 shell 有用
	- 注：执行命令本身而不是作为别名，可在命令前加反斜杠
* `history`：显示或操作历史命令列表

### 一、基础命令
* `echo`
	- `-E`：不解析转义字符
	- `-e`：解析转义字符
	- `-n`：不输出行尾换行符

### 二、系统命令
* `init n`：进入运行级 n（n 为 0-6 的数字）
* `logout`：用户退出系统
* `shutdown`, `halt`, `init 0`, `poweroff`：关机
* `uptime`：显示系统运行时间
* `mount [-t 文件系统类型] [-o 选项] 设备文件 挂载目录`：文件系统挂载
	- 文件系统类型有：iso9600，vfat，ntfs，msdos 等
	- 设备文件格式为`/dev/xxyN`
		+ `xx`：设备类型，hd、sd、fd 等
		+ `y`：同种设备的顺序号，如 a
		+ `N`：同一个设备编号，如硬盘分区的 1，2，5，6 等
	- `umount 设备名或挂载点`：卸载文件系统
* `df`：查看文件系统的空间占用
	- `-a`：显示所有
	- `-T`：显示文件系统的类型
	- `-h`：human 习惯的显示格式
* `du`：统计目录或文件占用空间
	- `-s`：只显示总数
	- `-a`：递归显示子目录即文件
	- `-b`：以字节为单位
	- `-c`：最后加总计
* `free`：显示内存使用状态
	- `-b`、`-k`、`-m`：以 Byte/KB/MB 显示
	- `-s <sec>`：持续观察，间隔`<sec>`秒
	- `-t`：显示总和
* `fdisk`：查看硬盘分区情况，对分区进行管理
	- `-l`：

### 三、文件命令
* `ls [选项] [文件]`：列出给定文件或目录的信息
	- `-a`, `--all`：列出所有（不隐藏'.'开头的项目）
	- `-d`, `--directory`：遇到目录，显示目录而不是目录内文件（例如`ls -d`结果就是一个点'.'）
	- `-F`：加上文件类型指示符号（`*/=@|`）
	- `-h`：易读格式
	- `-i`：加上文件的 indoe 号
	- `-l`：较长格式
	- `-Q`：将条目名称括上双引号
	- `-r`：逆序排列
	- `-R`：递归显示子目录
	- 排序相关
		+ `-U`：不排序（按目录顺序）
		+ `-S`：按文件大小排序
		+ `-t`：按时间
		+ `-v`：按版本
		+ `-X`：按扩展名
* `stat 文件名`：列出文件元数据
* `cd`
	- `cd -`：目录间切换
	- 注意：如果在 shell 脚本中使用 cd，运行脚本的时候要使用 source 命令（否则运行完脚本后会回到当前 shell 路径）
* `mkdir`
	- `-p`：若没有上层目录，创建父目录
	- `-m`：建立目录时设置权限，用法同`chmod`
* `touch`：建立新的空文件，或将已有文件的访问 / 修改时间设为当前或指定时间
* `file`：显示文件内容类型
* `cat [选项] [文件]`：显示文件内容，多个文件的话连起来
	- `-E`, `-e`：结尾显示`$`（小写等效于大写加`-v`）
	- `-n`：显示行号
	- `-T`, `-e`：Tab 显示为`^I`（小写等效于大写加`-v`）
* `tac`：类似`cat`，但逆序显示
* `more`：一次显示一个屏幕的内容
	- `+/str`：从包含 str 那行的前两行开始显示
	- `-nN`：每屏显示 N 行
	- `+N`：从第 N 行开始显示文件内容
* `less`：类似`more`，但可以上下浏览
* `mv 旧文件 新文件`：移动（重命名）文件，后者可以是目录
* `cp`：复制文件，类似`mv`
* `wc`：显示文件行数、单词数和大小
	- `-c`：只显示字符数
	- `-l`：只显示行数
	- `-w`：只显示单词数
* `uniq`：对已排序的文件去重（重复行）
	- `-c`：在每行前显示重复次数
	- `-d`：只显示重复行
	- `-u`：只显示未重复行
* `sort`：排序（多个）文件的内容，按行排序
	- `-b`：忽略前导空白
	- `-d`：字典序排序，仅排序字母数字空格制表
	- `-f`：不区分大小写
	- `-k pos1[, pos2]`：指定第 pos1 到 pos2 的字段为排序关键字（不指定 pos2，则到末尾）
	- `-r`：逆序
	- `-c`：检查是否排好序，如果没有则打印出错并以状态值 1 退出
	- `-o 输出文件`：将输出写入到文件
* `find 目录列表 表达式`：查找目录中匹配的文件，递归搜索（表达式由标准组成，标准如下）
	- `-name pattern`：搜索文件名匹配 pattern 的文件
	- `newer file`：修改时间在 file 之后的文件
	- `-print`：显示符合要求的文件路径和文件名
	- `user name`：搜索所有权为 name 的文件
	- `! expr`：对表达式 expr 取反
	- 示例命令：`find . \( -name core –o –name '*.ps' –o –name '*.p' \) –print –exec rm {} \;`搜索当前目录下文件名为 core 或者扩展名为 .ps 或者 .p 的文件，显示他们的绝对路径，并将它们删除。如要提示是否删除，将`-exec`换为`-ok`
* `grep [选项] [模式] [文件列表]`、`egrep`、`fgrep`：搜索文件内容（egrep 完全支持正则，fgrep 最快，grep 平衡）
	- `-c`：仅输出匹配的行的个数
	- `-i`：在匹配的过程中**忽略字母的大小写**
	- `-l`：仅输出有匹配行的文件名
	- `-n`：匹配时同时输出行号
	- `-s`：对shell脚本有用，避免出现错误信息(如果成功返回0，失败返回非零值)
	- `-v`：打印出不匹配的行
	- `-w`：**全字匹配**
	- 注：析取符号`|`在 egrep 里才有用
* `cut`：从**表格形式**的文件中截取字段
	- 默认以单个 tab 隔开
	- `-d char`：用 char 替换 tab 作为分隔符（char 可紧跟，注意`|`等字符有转义）
	- `-f5,1,2`：截取第 5、1、2 字段
* `paste`：水平连接列表
* `sed [选项] '命令' 文件名`：流编辑器
	- 替换命令：`s/regxp/replacement/flag`，将 regexp 替换为 replacement
* `dos2unix`、`unix2dos`：将 Windows 的文件换行符转换为 Linux；反过来
* `chmod [选项] 模式 文件列表`：改变文件的访问权限
	- `-R`：递归修改
	- `-r`：强制改变
	- 模式
		+ 符号模式
			| Who     | Operator   | Privilege                |
			| ------- | ---------- | ------------------------ |
			| u User  | + 增加特权 | r                        |
			| g Group | - 删除特权 | w                        |
			| o Other | = 设置特权 | x                        |
			| a All   |            | u 用户当前的访问特权     |
			|         |            | g 组当前的访问特权       |
			|         |            | o 其他用户当前的访问特权 |
		+ 八进制模式（三个八进制数）
			* 当参数不到 3 位时，右对齐匹配
* `unmask [mask]`：设置新创建文件的默认访问特权，mask 为 3 位八进制数，表示特权的取反（掩码）

### 、帮助命令
* `type 命令`：判断命令是内部命令还是外部命令
* `man 命令`、`info 命令`：获取帮助命令（类似在命令后加`--help`）
* `whatis 命令`：Linux 命令更短的描述

### 、快捷键
* `<Ctrl-C>`：终止当前命令
* `<Ctrl-D>`：结束当前命令的输入 / 退出Linux系统 / 从上层 shell 返回
* `<Ctrl-Z>`：暂停当前命令（放到 bg，可以用 fg 唤起）

## TODO
1. Linux 文件链接

## 遇到的问题
共享文件夹设置不成功

连不上网

nvim 的 vim-plug 插件安装不成功

报错`./if_demo1: 第 6 行： test: –f：需要一元表达式`
* 原因：从 pdf 复制代码过来的时候，符号`-`被复制成了`–`，前者是 Hyphen，后者是 En Dash

ls 命令的不同列不好用`cut`拆分
* 解决：不用`cut`获取字节数，而是先获取文件名列表，再循环使用`wc`命令

## 杂项
运行 bash 脚本的权限问题
* `chmod +x 文件名`或`chmod 777 文件名`给与权限

获取 root 权限（将用户设为 root 用户）
1. `sudo passwd root`，然后将密码重设一遍（或改成别的）
2. `su root`

脚本中变量引用使用双引号括起来
```bash
#!/bin/bash
# 若命令失败让脚本退出
set -o errexit
set -o nounset
echo "Names without double quotes"
echo

names="Tecmint FOSSMint Linusay"

for name in $names; do
		echo "$name"
done

echo
echo "Names with double quotes"
echo

for name in "$names"; do
		echo "$name"
done

exit 0
```
运行结果中，第一次循环输出的为：
```plain
Tecmint
FOSSMint
Linusay
```
第二次循环输出的为：
```plain
Tecmint FOSSMint Linusay
```

bash 中的括号小总结
* `test` <=> `[]`：if 判断
* `(())`：高级 if 判断，支持高级数学表达式
* `[[]]`：高级 if 判断，支持高级字符串处理
* `let` <=> `$(())` <=> `$[]`：数值运算，后两者是 shell 扩展
* `${}`：获取变量的值（常用数组）

shell 编程常见错误
* 使用变量忘了`$`
